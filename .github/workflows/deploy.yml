name: Deploy

on:
  push:
    branches: [main]

concurrency:
  group: deploy
  cancel-in-progress: true

jobs:
  deploy-api:
    name: Deploy API
    runs-on: ubuntu-latest
    if: github.event_name == 'push'

    steps:
      - uses: actions/checkout@v4

      - name: Build API Docker image
        run: docker build -t renditionready-api ./apps/api

      # Add your deployment steps here (e.g., push to ECR, deploy to ECS/Fly.io/Railway)
      - name: Deploy placeholder
        run: echo "API image built successfully. Add deployment target configuration."

  deploy-web:
    name: Deploy Web
    runs-on: ubuntu-latest
    if: github.event_name == 'push'

    steps:
      - uses: actions/checkout@v4

      - name: Build Web Docker image
        run: |
          docker build \
            --build-arg NEXT_PUBLIC_API_URL=${{ secrets.NEXT_PUBLIC_API_URL }} \
            --build-arg NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=${{ secrets.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY }} \
            --build-arg NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=${{ secrets.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY }} \
            -t renditionready-web ./apps/web

      # Add your deployment steps here
      - name: Deploy placeholder
        run: echo "Web image built successfully. Add deployment target configuration."
